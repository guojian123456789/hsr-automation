# 📱 HSR Automation APK 安装指南

## 🎉 恭喜！构建成功！

---

## 📥 下载 APK

### 1. 访问 GitHub Actions
```
https://github.com/guojian123456789/hsr-automation/actions
```

### 2. 下载 Artifact
- 点击最新的成功构建（✅ 绿色勾）
- 滚动到底部 "Artifacts" 部分
- 点击 `hsr-automation-apk` 下载
- 解压 ZIP 得到 `.apk` 文件

---

## 📱 安装到 Android 手机

### 方法1：ADB 安装（推荐）

#### 准备工作：
1. **安装 ADB 工具**
   - Windows: https://dl.google.com/android/repository/platform-tools-latest-windows.zip
   - 解压到任意目录（如 `C:\adb\`）

2. **启用手机 USB 调试**
   - 设置 → 关于手机 → 连续点击 "版本号" 7次
   - 返回设置 → 开发者选项 → 启用 "USB调试"

3. **连接手机到电脑**
   - 使用 USB 数据线连接
   - 手机弹出"允许USB调试"，点击"确定"

#### 安装命令：

```powershell
# 1. 检查设备连接
adb devices

# 应该显示：
# List of devices attached
# XXXXXXXX        device

# 2. 安装 APK
adb install hsrautomation-1.0-arm64-v8a-debug.apk

# 成功显示：
# Success
```

---

### 方法2：直接安装

#### 步骤：
1. **将 APK 复制到手机**
   - 通过 USB 传输
   - 或通过微信/QQ 发送到手机

2. **打开文件管理器**
   - 找到下载的 APK 文件

3. **点击 APK 文件**
   - 如果提示"禁止安装未知来源应用"
   - 点击"设置" → 启用"允许此来源"

4. **点击"安装"**
   - 等待安装完成
   - 点击"打开"

---

## ⚙️ 首次运行配置

### 1. 授予权限

启动应用后，需要授予以下权限：

#### ✅ 必需权限：

1. **无障碍服务权限** (Accessibility Service)
   - 用于模拟点击操作
   - 设置 → 无障碍 → HSR Automation → 启用

2. **悬浮窗权限** (Display over other apps)
   - 用于显示悬浮按钮
   - 设置 → 应用 → HSR Automation → 悬浮窗权限 → 允许

3. **存储权限** (Storage)
   - 用于保存截图和日志
   - 应用首次启动时会自动请求

#### 📸 截图权限（重要）：

**MediaProjection 权限**：
- 首次使用截图功能时会弹出请求
- 点击"立即开始"允许屏幕录制
- 这是 Android 获取截图的标准方式

---

## 🚀 开始使用

### 1. 启动应用
```
应用列表 → HSR Automation → 点击打开
```

### 2. 授予权限
- 按照提示授予所有必要权限
- 特别注意无障碍服务和悬浮窗权限

### 3. 配置任务
- 在主界面勾选需要执行的任务
- 例如：Daily Commission（委托任务）

### 4. 开始自动化
- 打开游戏
- 点击"Start"按钮
- 应用会自动执行任务

---

## 🎮 功能说明

### 当前可用功能：

| 功能 | 说明 | 状态 |
|------|------|------|
| **登录检测** | 自动检测登录界面并点击 | ✅ 可用 |
| **委托任务** | 自动执行每日委托 | ✅ 可用 |
| **基础点击** | 模拟点击操作 | ✅ 可用 |
| **图像识别** | 基于 PIL 的模板匹配 | ⚠️ 精度有限 |

### 注意事项：

1. **图像识别功能受限**
   - 由于移除了 OpenCV 和 NumPy
   - 当前使用 PIL 的基础实现
   - 识别精度可能不够高

2. **后续改进方向**：
   - 使用固定坐标替代图像识别
   - 或在桌面版使用 OpenCV

---

## 🐛 常见问题

### Q1: 安装失败 - "解析包时出现问题"

**A**: 
- 确保是 **arm64-v8a** 架构的手机
- 大多数现代手机（2018年后）都是 arm64
- 如果是老手机，需要重新构建 armeabi-v7a 版本

### Q2: 应用闪退

**A**:
1. 检查权限是否全部授予
2. 查看系统日志：
   ```bash
   adb logcat | grep -i "python"
   ```

### Q3: 无障碍服务无法启用

**A**:
- 某些手机（小米、OPPO等）需要额外步骤
- 设置 → 无障碍 → 已安装的服务
- 找到 HSR Automation → 手动启用

### Q4: 截图功能不工作

**A**:
1. 确保授予了 MediaProjection 权限
2. 重启应用后重新授权
3. 检查是否有其他录屏应用占用

### Q5: 自动化不准确

**A**:
- 当前版本图像识别功能有限
- 建议在游戏稳定界面使用
- 或考虑使用固定坐标模式

---

## 🔄 更新应用

### 方法1：重新构建
```bash
# 1. 修改代码
# 2. 提交推送
git add .
git commit -m "Update: xxx"
git push

# 3. GitHub Actions 自动构建
# 4. 下载新的 APK
```

### 方法2：增量更新
```bash
# 直接安装新版 APK 会覆盖旧版
adb install -r hsrautomation-新版本.apk
```

---

## 📊 性能优化建议

### 1. 降低截图频率
- 修改 `image_processor.py` 中的检测间隔
- 减少 CPU 使用

### 2. 使用固定坐标
- 避免图像识别开销
- 提高执行速度

### 3. 后台运行优化
- 设置 → 电池 → HSR Automation
- 允许后台运行
- 禁用电池优化

---

## 🎯 下一步计划

### 短期改进：
1. ✅ 验证基础功能
2. 📝 收集用户反馈
3. 🔧 修复发现的 bug
4. 📈 优化性能

### 长期计划：
1. 添加更多游戏任务
2. 改进图像识别（考虑添加 NumPy）
3. 增加 UI 功能
4. 多语言支持

---

## 🙏 感谢使用！

**项目地址**：
```
https://github.com/guojian123456789/hsr-automation
```

**问题反馈**：
- GitHub Issues
- 或直接联系开发者

---

## 📝 快速检查清单

安装前：
- [ ] 下载 APK
- [ ] 启用 USB 调试（如使用 ADB）
- [ ] 备份重要数据

安装时：
- [ ] 允许未知来源安装
- [ ] 安装成功

首次启动：
- [ ] 授予无障碍服务权限
- [ ] 授予悬浮窗权限
- [ ] 授予存储权限
- [ ] 授予截图权限（MediaProjection）

开始使用：
- [ ] 打开游戏
- [ ] 配置任务
- [ ] 点击 Start
- [ ] 验证功能

---

**祝使用愉快！** 🎉

