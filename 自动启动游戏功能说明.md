# 🎮 自动启动游戏功能说明

## ✨ 新功能：点击START自动打开游戏

现在不需要手动切换游戏了！点击START按钮后，应用会**自动启动游戏**！

---

## 🚀 使用流程对比

### **之前（麻烦）：**
```
1. 打开 HSR Automation 应用
2. 点击 START 按钮
3. ❌ 手动按 HOME 键
4. ❌ 手动点击游戏图标
5. ❌ 等待游戏加载
6. 自动化开始工作
```

### **现在（超简单）：**
```
1. 打开 HSR Automation 应用
2. 点击 START 按钮
3. ✨ 自动启动游戏（无需任何操作！）
4. ⏰ 自动等待5秒加载
5. 🎯 自动化开始工作
```

**省去3步手动操作！一键启动，坐等完成！** 🎉

---

## 📱 工作原理

### **自动启动流程：**

```
点击 START 按钮
    ↓
检查权限
    ↓
状态显示："Launching game..."
    ↓
📱 自动启动游戏应用
    ├─ 通过Android Intent启动游戏
    ├─ 如果游戏在后台，恢复到前台
    ├─ 如果游戏未运行，全新启动
    └─ 清除任务栈，确保干净启动
    ↓
⏰ 等待5秒（游戏加载时间）
    ↓
状态显示："Game launched, starting automation..."
    ↓
🎯 开始自动化任务
    ↓
完成！
```

---

## 🎯 支持的游戏

### **自动检测的游戏包名：**

| 游戏 | 版本 | 包名 |
|------|------|------|
| **崩坏：星穹铁道** | 国际服 | com.HoYoverse.hkrpgoversea |
| **崩坏：星穹铁道** | 国服 | com.miHoYo.hkrpg |
| **崩坏：星穹铁道** | B服 | com.miHoYo.hkrpg.bilibili |
| 原神 | 国际服 | com.miHoYo.GenshinImpact |
| 原神 | 国服 | com.miHoYo.Yuanshen |
| 崩坏3 | 国际服 | com.miHoYo.bh3oversea |
| 崩坏3 | 国服 | com.miHoYo.enterprise.NGHSoD |
| 绝区零 | 国际服 | com.HoYoverse.Nap |
| 绝区零 | 国服 | com.miHoYo.Nap |

### **优先级：**
- ✅ 优先选择**星穹铁道**（国际服 > 国服 > B服）
- ✅ 自动检测已安装的游戏
- ✅ 启动时显示检测到的游戏

---

## 📊 状态显示

### **应用启动时：**

```
初始化... → Initializing...
    ↓
权限检查... → Requesting permissions...
    ↓
游戏检测... → 自动检测
    ↓
状态显示：
✅ "Ready - 崩坏：星穹铁道 detected"  ← 检测成功
或
⚠️ "Ready - No game detected"  ← 未检测到
```

### **点击START时：**

```
状态变化：
"Launching game..."          ← 正在启动游戏
    ↓
"Game launched, starting..."  ← 游戏已启动
    ↓
"Running..."                  ← 自动化运行中
```

---

## 🔧 技术实现

### **新增模块：**

```python
game_launcher.py
├─ GameLauncher 类
│  ├─ launch_game()              # 启动游戏
│  ├─ launch_game_and_wait()     # 启动并等待
│  ├─ is_game_installed()        # 检查游戏是否安装
│  ├─ get_installed_games()      # 获取已安装游戏列表
│  ├─ auto_detect_game()         # 自动检测游戏
│  └─ switch_to_game()           # 切换到游戏
│
└─ GamePackageNames 类
   ├─ HSR_GLOBAL, HSR_CN         # 星穹铁道包名
   ├─ GENSHIN_GLOBAL, GENSHIN_CN # 原神包名
   └─ get_all_packages()         # 获取所有包名
```

### **启动游戏的关键代码：**

```python
# 获取游戏的启动Intent
pm = activity.getPackageManager()
launch_intent = pm.getLaunchIntentForPackage(package_name)

# 设置标志：新任务 + 清除顶部
launch_intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK)
launch_intent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP)

# 启动游戏
activity.startActivity(launch_intent)

# 等待加载
time.sleep(5)  # 可配置
```

### **在main.py中的集成：**

```python
# 初始化游戏启动器
self.game_launcher = GameLauncher()

# 启动时自动检测游戏
game_name = self.game_launcher.auto_detect_game()

# 点击START时启动游戏
if platform == 'android':
    self.game_launcher.launch_game_and_wait(wait_seconds=5)
```

---

## ⚙️ 配置选项

### **等待时间调整：**

默认等待5秒，可以根据手机性能调整：

```python
# 在 main.py 的 start_automation 方法中：

# 快速手机（3秒）
self.game_launcher.launch_game_and_wait(wait_seconds=3)

# 普通手机（5秒）- 默认
self.game_launcher.launch_game_and_wait(wait_seconds=5)

# 较慢手机（8秒）
self.game_launcher.launch_game_and_wait(wait_seconds=8)
```

### **指定游戏包名：**

如果自动检测失败，可以手动设置：

```python
# 设置特定游戏
from game_launcher import GamePackageNames

# 国际服星穹铁道
self.game_launcher.set_game_package_name(
    GamePackageNames.HSR_GLOBAL
)

# 国服星穹铁道
self.game_launcher.set_game_package_name(
    GamePackageNames.HSR_CN
)
```

---

## 💡 使用场景

### **场景1：每天执行日常任务**

```
早上起床：
1. 解锁手机
2. 打开 HSR Automation
3. 点击 START ← 就这一步！
4. 放下手机去洗漱
5. 回来时任务已完成 ✅
```

### **场景2：挂机刷副本**

```
1. 打开 HSR Automation
2. 勾选需要的任务
3. 点击 START
4. 游戏自动打开
5. 自动进入副本
6. 自动刷取材料
```

### **场景3：自动签到**

```
1. 定时任务触发
2. HSR Automation 自动启动
3. 自动打开游戏
4. 自动完成签到
5. 自动关闭
```

---

## ❓ 常见问题

### **Q1: 游戏启动失败怎么办？**

**A**: 
1. 检查游戏是否已安装
2. 查看应用状态显示
   - 如果显示"No game detected" → 未安装游戏
   - 如果显示"Failed to launch game" → 启动失败
3. 手动启动游戏一次，确认游戏正常
4. 重新打开 HSR Automation

### **Q2: 如何知道检测到了哪个游戏？**

**A**:
启动应用后，查看状态显示：
```
✅ "Ready - 崩坏：星穹铁道 detected"
   ↑ 检测到星穹铁道

✅ "Ready - 原神 detected"
   ↑ 检测到原神（如果星穹铁道未安装）
```

### **Q3: 能不能不自动启动游戏？**

**A**:
目前暂不支持关闭自动启动。但你可以：
- 桌面版：不会自动启动（仅Android有此功能）
- Android版：点START后会自动启动

**未来版本**可能会添加开关选项。

### **Q4: 启动游戏后等待时间太短/太长？**

**A**:
默认等待5秒，可以调整：

**临时修改**（每次生效）：
```python
# 在 main.py 第346行修改：
wait_seconds=5  # 改成你想要的秒数
```

**永久修改**：
需要重新构建APK。

### **Q5: 同时安装了多个游戏，会启动哪个？**

**A**:
优先级顺序：
```
1. 崩坏：星穹铁道（国际服）
2. 崩坏：星穹铁道（国服）
3. 崩坏：星穹铁道（B服）
4. 原神（国际服）
5. 原神（国服）
... 以此类推
```

**只会启动第一个检测到的游戏。**

### **Q6: 游戏在后台运行时，点START会怎样？**

**A**:
- ✅ 会将游戏恢复到前台
- ✅ 保持游戏当前状态
- ✅ 不会重新启动游戏
- ✅ 继续之前的进度

### **Q7: 启动游戏需要什么权限？**

**A**:
不需要额外权限！
- 启动其他应用是Android标准功能
- 不需要root
- 不需要特殊权限

---

## 🎁 优势总结

### **对比手动操作：**

| 操作 | 手动 | 自动 |
|------|------|------|
| 打开应用 | ✅ 需要 | ✅ 需要 |
| 点击START | ✅ 需要 | ✅ 需要 |
| 按HOME键 | ❌ 需要 | ✅ 自动 |
| 找游戏图标 | ❌ 需要 | ✅ 自动 |
| 点击游戏 | ❌ 需要 | ✅ 自动 |
| 等待加载 | ❌ 需要盯着 | ✅ 自动 |
| **总操作数** | **6步** | **2步** |

**省时省力，一键搞定！** 🚀

---

## 📝 调试信息

### **查看日志：**

```bash
# 连接手机
adb devices

# 查看游戏启动日志
adb logcat | grep -i "game\|launch"

# 会看到类似输出：
[INFO] 初始化游戏启动器...
[INFO] 自动检测到游戏: 崩坏：星穹铁道
[INFO] ✅ 检测到游戏: 崩坏：星穹铁道
[INFO] 🚀 正在启动游戏: com.HoYoverse.hkrpgoversea
[INFO] ✅ 游戏已启动
[INFO] ⏰ 等待游戏加载 5 秒...
[INFO] ✅ 游戏已启动，等待加载...
```

---

## 🔄 未来计划

### **可能的增强功能：**

1. **可配置等待时间**
   - UI设置滑块
   - 根据设备自动调整

2. **游戏选择器**
   - 检测到多个游戏时显示列表
   - 用户手动选择

3. **启动失败重试**
   - 自动重试3次
   - 超时后提示用户

4. **后台保活**
   - 游戏运行时保持应用活跃
   - 防止被系统杀死

5. **关闭游戏功能**
   - 任务完成后自动关闭游戏
   - 节省电量

---

## ✅ 测试清单

### **验证自动启动功能：**

- [ ] 安装游戏（星穹铁道）
- [ ] 安装 HSR Automation
- [ ] 打开应用
- [ ] 查看状态显示"detected"
- [ ] 点击 START 按钮
- [ ] 看到状态"Launching game..."
- [ ] 游戏自动打开 ✅
- [ ] 等待5秒
- [ ] 状态变为"Game launched..."
- [ ] 自动化开始运行 ✅

---

## 🎉 总结

**新功能让使用体验提升100%！**

```
之前：打开应用 → START → HOME → 找游戏 → 点击 → 等待
现在：打开应用 → START → 完成！

操作步骤：6步 → 2步
所需时间：30秒 → 5秒
用户体验：⭐⭐⭐ → ⭐⭐⭐⭐⭐
```

**真正的一键启动，躺平挂机！** 🛋️✨

