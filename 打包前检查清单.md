# ✅ Android APK打包前检查清单

## 📋 打包前必查项目

### 1. 文件完整性检查

- [x] `main.py` - 主程序入口
- [x] `automation_engine.py` - 核心引擎
- [x] `image_processor.py` - 图像处理
- [x] `game_controller.py` - 游戏控制
- [x] `task_manager.py` - 任务管理
- [x] `android_utils.py` - Android工具类
- [x] `buildozer.spec` - 构建配置
- [x] `requirements.txt` - 依赖列表

### 2. 模板图像检查

确保 `templates/` 目录包含所有必需的PNG文件：

- [x] login_button_first.png
- [x] game_start_screen.png
- [x] login_button.png
- [x] task.png
- [x] weituo.png
- [x] qianwang.png
- [x] yijianlingqu.png
- [x] paiqianzhong.png
- [x] close.png
- [x] zaicipaiqian.png
- [x] 120kaituoli.png
- [x] jinru.png
- [x] jiahao.png
- [x] tiaozhan.png
- [x] kaishitiaozhan.png
- [x] beisukai.png
- [x] beisuguan.png
- [x] zidongkai.png
- [x] zidongguan.png
- [x] zailaiyici.png
- [x] tuichuguanqia.png
- [x] lingqu.png
- [x] 400.png
- [x] 500.png
- [x] gift.png

### 3. 配置文件检查

#### buildozer.spec

```ini
[app]
title = HSR Automation
package.name = hsrautomation
package.domain = com.hsr.automation
version = 1.0

requirements = python3,kivy,numpy,pillow,opencv,pyyaml

android.permissions = SYSTEM_ALERT_WINDOW,WRITE_EXTERNAL_STORAGE,READ_EXTERNAL_STORAGE,INTERNET,ACCESS_NETWORK_STATE,WAKE_LOCK,FOREGROUND_SERVICE

android.api = 33
android.minapi = 21
android.arch = arm64-v8a
```

- [x] 版本号正确
- [x] 包名符合规范
- [x] 权限列表完整
- [x] API版本合适

### 4. 代码检查

- [x] 移除所有调试代码
- [x] 移除所有print语句（使用Logger）
- [x] 检查硬编码路径
- [x] 确保相对路径正确
- [x] 异常处理完整

### 5. 依赖检查

```bash
# 验证所有依赖都在requirements.txt中
pip freeze | grep -E "(kivy|numpy|pillow|opencv|pyyaml)"
```

- [x] Kivy >= 2.3.0
- [x] NumPy >= 1.24.0
- [x] Pillow >= 10.0.0
- [x] OpenCV >= 4.8.0
- [x] PyYAML >= 6.0.0

## 🚀 构建步骤

### Windows用户（Docker方案）

```batch
# 1. 清理旧构建（可选）
build_android_docker.bat clean

# 2. 构建Debug版本
build_android_docker.bat debug

# 3. 构建Release版本（可选）
build_android_docker.bat release
```

### Linux/Mac用户

```bash
# 1. 清理旧构建（可选）
./build_android.sh clean

# 2. 构建Debug版本
./build_android.sh debug

# 3. 构建Release版本（可选）
./build_android.sh release
```

## 📊 构建过程检查

### 构建日志检查

- [ ] 依赖下载成功
- [ ] SDK/NDK下载完成
- [ ] Python编译成功
- [ ] Kivy编译成功
- [ ] OpenCV编译成功
- [ ] APK签名成功（Release版）

### 常见错误处理

**错误1: Java版本不对**
```bash
# 安装Java 17
sudo apt install openjdk-17-jdk
export JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64
```

**错误2: 内存不足**
```ini
# 在buildozer.spec中增加内存
[buildozer]
android.gradle_jvmargs = -Xms512m -Xmx2048m
```

**错误3: OpenCV编译失败**
```ini
# 使用headless版本
requirements = python3,kivy,numpy,pillow,opencv-python-headless,pyyaml
```

## 📲 测试步骤

### 1. APK基础检查

```bash
# 查看APK信息
aapt dump badging bin/hsrautomation-1.0-arm64-v8a-debug.apk

# 检查文件大小（应该在10-50MB之间）
du -h bin/hsrautomation-1.0-arm64-v8a-debug.apk
```

### 2. 安装测试

```bash
# 安装到测试设备
adb install bin/hsrautomation-1.0-arm64-v8a-debug.apk

# 查看安装日志
adb logcat | grep python
```

### 3. 功能测试清单

- [ ] 应用可以正常启动
- [ ] UI界面显示正常
- [ ] 按钮可以点击
- [ ] 日志正常输出
- [ ] 权限申请正常（如果已适配）
- [ ] 截图功能正常（如果已适配）
- [ ] 点击功能正常（如果已适配）

## 🎯 发布前检查

### Release版本特殊要求

1. **签名密钥**
   ```bash
   # 生成密钥
   keytool -genkey -v -keystore my-release-key.jks \
     -keyalg RSA -keysize 2048 -validity 10000 \
     -alias my-key-alias
   ```

2. **版本号更新**
   - 修改 `buildozer.spec` 中的 `version`
   - 更新 `android.numeric_version`（可选）

3. **混淆配置**（可选）
   - 添加ProGuard规则
   - 保护敏感代码

4. **资源优化**
   - 压缩图片资源
   - 移除未使用的模板
   - 优化APK大小

## 📝 发布清单

- [ ] 版本号已更新
- [ ] 更新日志已编写
- [ ] README已更新
- [ ] 截图已准备
- [ ] APK已签名
- [ ] APK已测试
- [ ] 发布说明已准备

## ⚠️ 重要提醒

### 当前版本限制

**注意**: 当前版本主要为桌面环境设计，打包成APK后：

- ✅ UI可以正常显示
- ❌ **截图功能需要适配** - 需要MediaProjection API
- ❌ **点击功能需要适配** - 需要Accessibility Service
- ❌ **权限申请需要适配** - 需要运行时权限管理

### 推荐发布说明

```
【版本】1.0
【状态】Beta - 桌面功能完整，Android版需要额外适配
【支持平台】Windows, Linux, macOS
【Android支持】UI界面可用，核心功能需要适配

【使用建议】
- 推荐使用桌面版（功能完整）
- Android版仅供测试UI界面
- 如需Android完整功能，请等待后续更新
```

## 🎉 完成！

检查完以上所有项目后，你就可以开始构建APK了！

```bash
# Windows
build_android_docker.bat debug

# Linux/Mac
./build_android.sh debug
```

---

**提示**: 首次构建可能需要30-60分钟，请耐心等待！

